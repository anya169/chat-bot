{% load static %} 

<!DOCTYPE html>
<html>
<head>
   <title>Информация о сотруднике</title>
   <link rel="stylesheet" href="{% static '/css/common.css' %}">
   <link rel="stylesheet" href="{% static '/css/tables.css' %}">
   <link rel="stylesheet" href="{% static '/css/employee.css' %}">
</head>
<body class='layout'>
   {% block sidebar %}
      {% include 'includes/sidebar.html' %}
   {% endblock %}
   <main class="content">
      <h3>Информация о сотруднике</h3>
      
      <!-- Информация о сотруднике -->
      <div class="employees-panel">
         <div class="account">
            <span class="employee__info">{{ employee.name }}</span>
            <div class="employee__info">Филиал: {{ employee.filial.name|default:"-" }}</div>
            <div class="employee__info">Подразделение: {{ employee.struct.name|default:"-" }}</div>
            <div class="employee__info">Табельный номер: {{ employee.num_tab|default:"-" }}</div>
            <div class="employee__info">Email: {{ employee.email|default:"-" }}</div>
            <div class="employee__info">Дата приема на работу: {{ employee.hire_date|date:"d.m.Y"|default:"-" }}</div>     
            <div class="employee__info">Дата первого обращения к боту: {{ employee.telegram_registration_date|date:"d.m.Y"|default:"-" }}</div> 
            <div class="employee__info">Количество пройденных опросов: {{ count|default:"-" }}</div> 
         </div>
      </div>

      <h3>Пройденные опросы</h3>
      
      <!-- Еженедельный опрос -->
      {% if has_weekly_answers %}
      <div class="employees-panel">
         <h4>Еженедельный опрос</h4>
         <table class="weekly-poll-table employee-table">
            <thead>
               <tr>
                  <th></th>
                  {% for question in weekly_questions %}
                  <th>{{ question.name }}</th>
                  {% endfor %}
               </tr>
            </thead>
            <tbody>
               {% for period, dates in grouped_weekly_data.items %}
               <!-- Заголовок периода -->
               <tr>
                  <td class="period-header" colspan="{{ weekly_questions.count|add:1 }}">
                     {{ period }}
                  </td>
               </tr>
               
               {% for date_str, date_data in dates.items %}
               <!-- Заголовок даты -->
               <tr>
                  <td class="date-header" colspan="{{ weekly_questions.count|add:1 }}">
                     {{ date_data.date|date:"d.m.Y" }}
                  </td>
               </tr>
               
               <!-- Ответы для этой даты -->
               <tr>
                  <td class="question-column">Ответы</td>
                  {% for question in weekly_questions %}
                  <td>
                     {% for answer_key, answer_value in date_data.answers.items %}
                        {% if answer_key == question.id|stringformat:"s" %}
                           {{ answer_value.name|default:"-" }}
                        {% endif %}
                     {% endfor %}
                  </td>
                  {% endfor %}
               </tr>
               {% endfor %}
               {% endfor %}
            </tbody>
         </table>
      </div>
      {% endif %}

      <!-- Остальные опросы -->
      <div class="employees-panel">
         <div class="polls-tables">
            {% for poll_data in polls_data %}
               <h4>{{ poll_data.poll.name }}</h4>
               <table class="employee-table poll-table">
                  <thead>
                     <tr>
                        <th>Вопрос</th>
                        <th>Ответ</th>
                     </tr>
                  </thead>
                  <tbody>
                     {% for questionanswer in poll_data.questions_answers %}
                        <tr>
                           <td>{{ questionanswer.question.name }}</td>
                           <td>{{ questionanswer.answer.name|default:"-" }}</td> 
                        </tr> 
                     {% endfor %}
                  </tbody>
               </table>
            {% empty %}
               <div>Не пройдено ни одного опроса</div>
            {% endfor %}
         </div>
      </div>   
   </main>
</body>
</html>